# 哔哩哔哩动态快捷操作 Chrome 插件

一个用于快捷操作哔哩哔哩动态页面的谷歌浏览器插件，支持侧边工具栏快速点赞、收藏和批量处理图片。

## 功能特性

### 核心功能
- **快捷点赞**: 一键点赞/取消点赞当前动态
- **快捷收藏**: 一键收藏/取消收藏当前动态
- **图片批量处理**: 支持下载所有图片或在新标签页打开
- **快捷操作按钮**: 在动态页面侧边工具栏添加"快捷操作"按钮
- **执行所有页面**: 对所有打开的 Bilibili 动态页面批量执行快捷操作

### 自定义设置
- **功能排除设置**: 可单独开启/关闭点赞、收藏、图片处理功能
- **图片操作设置**: 选择下载图片或在新标签页打开
- **智能图片提取**: 从动态内容容器中提取图片，通过URL特征筛选有效图片

## 安装方法

### 开发者模式安装
1. 打开 Chrome 浏览器，进入 `chrome://extensions/`
2. 开启右上角的"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择本插件的根目录文件夹
5. 插件安装完成

## 使用方法

### 基本操作
1. 打开任意哔哩哔哩动态页面（URL格式：`https://www.bilibili.com/opus/xxx`）
2. 等待页面完全加载（约2秒后自动添加快捷操作按钮）
3. 在页面右侧侧边工具栏找到"快捷操作"按钮（星星图标）
4. 点击"快捷操作"按钮执行预设功能

### 设置配置
1. 点击浏览器工具栏中的插件图标
2. 在弹出的设置页面中调整：
   - **功能排除设置**：开启/关闭点赞、收藏、图片处理功能
   - **图片操作设置**：选择下载图片或在新标签页打开
3. 点击"保存设置"应用更改
4. 点击"执行快捷操作"按钮立即执行当前设置
5. 点击"执行所有页面"按钮对所有打开的 Bilibili 动态页面批量执行快捷操作

### 快捷操作说明
- **一键执行**：点击"快捷操作"按钮同时执行所有开启的功能
- **智能切换**：点赞和收藏功能支持状态切换（已点赞/收藏会取消）
- **图片处理**：根据设置自动下载或在新标签页打开所有动态图片

## 文件结构

```
├── manifest.json          # 插件配置文件
├── background.js          # 后台服务脚本
├── content.js            # 页面内容脚本
├── executeQuickActions.js # 快捷操作共享函数
├── popup.html            # 设置页面HTML
├── popup.js              # 设置页面脚本
└── icons/                # 图标文件夹
    ├── icon16.png        # 16x16图标
    ├── icon48.png        # 48x48图标
    ├── icon128.png       # 128x128图标
    ├── 快捷操作.svg      # 快捷操作按钮图标
    └── README.md
```

## 技术实现

### 页面适配
插件通过以下方式适配哔哩哔哩动态页面：
- **快捷操作按钮**：在侧边工具栏添加自定义按钮（`.side-toolbar__action.quick-action`）
- **点赞按钮**：使用`.side-toolbar__action.like`选择器
- **收藏按钮**：使用`.side-toolbar__action.favorite`选择器
- **图片提取**：智能提取动态内容图片，排除用户头像和装饰图片

### 图片处理
- **智能提取**：从动态内容容器中提取图片URL（支持多种动态页面格式）
- **URL清理**：去除@符号后的尺寸控制字符，获取原始图片
- **文件名保留**：下载时使用URL中的原始文件名
- **批量处理**：支持下载或新标签页打开所有图片

### 权限说明
- `activeTab`: 访问当前活动标签页
- `storage`: 保存用户设置
- `scripting`: 注入内容脚本
- `downloads`: 下载动态图片
- `contextMenus`: 右键菜单功能
- `tabs`: 查询所有标签页信息

## 注意事项

1. **图标文件**: 需要手动添加图标文件到 `icons/` 文件夹
2. **页面适配**: 如果哔哩哔哩页面结构更新，可能需要调整选择器
3. **功能限制**: 点赞和收藏操作需要用户已登录哔哩哔哩账号
4. **网络请求**: 批量下载图片时请确保网络连接稳定

## 更新日志

### v2.0
- 新增"执行所有页面"功能，支持对所有打开的 Bilibili 动态页面批量执行快捷操作
- 新增 executeQuickActions.js 共享函数文件，统一快捷操作逻辑
- 优化脚本注入机制：使用 chrome.scripting.executeScript 动态注入
- 修复按钮重复添加问题，将状态标记改为实例变量
- 优化日志输出：区分 Content 和 Popup 来源
- 实现按需加载：点击按钮时才注入脚本
- 添加函数存在性检查，防止重复加载脚本
- 统一图片操作类型：open-tab 统一为 open

### v1.0
- 初始版本发布
- 实现基本点赞、收藏功能
- 支持图片批量下载和新标签页打开
- 添加用户设置界面

## 许可证

MIT License